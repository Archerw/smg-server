<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Main Page</title>
<script
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<link rel="stylesheet"
	href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />
<script
	src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
<link rel="stylesheet"
	href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<link rel="stylesheet"
	href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap-theme.min.css">
<script
	src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<link
	href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css"
	rel="stylesheet">
<!--<link href="./css/float.css" rel="stylesheet">
<script src="./js/float.js">-->
</head>
<body>
	<script type="text/javascript">
		function getUrlParam(name) {
		    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)"); 
		    var r = window.location.search.substr(1).match(reg);  
		    if (r!=null) return unescape(r[2]); return null; 
		}
		//var domain = "3-dot-smg-server.appspot.com";
		//var domain = "localhost:8888";
		var domain = "smg-server.appspot.com";
		var isSocial = getUrlParam("isSocial");
		var userId = getUrlParam("userId");
		var accessSignature = getUrlParam("accessSignature");
				
		if(isSocial == undefined)
			isSocial = true;
		// Simple jsonify - doesn't handle nesting
		function jsonify(array) {
			var json = {};
			for (var i = 0; i < array.length; i++) {
				var obj = array[i];
				if (obj.value) {
					json[obj.name] = obj.value;
				}
			}
			return json;
		}

		$(document).ready( function() {
			$("#logouturl").prop('href', "http://" + domain + '/userLogOut/' + userId + '?accessSignature=' +accessSignature);
			$("#playerpage").prop('src', "http://smg-angularjs-player.appspot.com/index.html#/profile/" + userId + "?accessSignature=" + accessSignature);
			$("#developerpage").prop('src', "http://www.w3schools.com")
			if(isSocial == true) {
				$("#formId1").hide();
			} else {
				$("#formId2").hide();
			}
			$("#post1").submit(function(e) {
				// Prevent all default form submission
				e.preventDefault();

				var formValues = jsonify($(this).serializeArray());
				if (formValues.password != formValues.confirm) {
					document.getElementById("response").innerHTML = "Please enter the same password";
					return;
				} else {
					document.getElementById("response").innerHTML = "";
				}

				var jsonObj = {
					"email" : formValues.email,
					"password" : formValues.password,
					"firstName" : formValues.firstName,
					"lastName" : formValues.lastName,
					"nickName" : formValues.nickName,
					"accessSignature" : accessSignature
				};
				$.ajax({
					url : "http://" + domain + "/userinfo/"+userId,
					dataType : "json",
					type : "PUT",
					data : JSON.stringify(jsonObj),
					success : function(data, textStatus, jqXHR) {
						//$("#response").append("<p>" + JSON.stringify(data) + "</p>");
						if (data["error"] == undefined) {
							document.getElementById("response").innerHTML = "Update success";
						} else {
							document.getElementById("response").innerHTML = data["error"].toString();
						}
					},
					error : function(jqXHR, textStatus, errorThrown) {
						alert("ERROR: " + textStatus + " " + errorThrown);
					}
				});
				
				$.ajax({
					url : "http://" + domain + "/userinfo/"+userId+"?accessSignature="+accessSignature,
					dataType : "json",
					type : "GET",
					success : function(data, textStatus, jqXHR) {
						//$("#response").append("<p>" + JSON.stringify(data) + "</p>");
						if (data["error"] == undefined) {
							$("#greeting").text("Hi, " + data['firstName']);
						} else {
							$("#greeting").text(data["error"]);
						}
					},
					error : function(jqXHR, textStatus, errorThrown) {
						alert("ERROR: " + textStatus + " " + errorThrown);
					}
				});
			});
			$("#post2").submit(function(e) {
				// Prevent all default form submission
				e.preventDefault();

				var formValues = jsonify($(this).serializeArray());

				var jsonObj = {
					"firstname" : formValues.firstName,
					"lastname" : formValues.lastName,
					"nickname" : formValues.nickName
				};

				console.log("2");
				$.ajax({
					url : "http://" + domain + "/userinfo",
					dataType : "json",
					type : "PUT",
					data : JSON.stringify(jsonObj),
					success : function(data, textStatus, jqXHR) {
						//$("#response").append("<p>" + JSON.stringify(data) + "</p>");
						if (data["error"] == undefined) {
							document.getElementById("response").innerHTML = "Update success";
						} else {
							document.getElementById("response").innerHTML = data["error"].toString();
						}
					},
					error : function(jqXHR, textStatus, errorThrown) {
						alert("ERROR: " + textStatus + " " + errorThrown);
					}
				});
			});
		});
	</script>
	<div class="container">
		<ul id="tabs" class="nav nav-pills">
			<li><a href="#play" data-toggle="tab"><span class="glyphicon glyphicon-tower"></span> Play</a></li>
			<li><a href="#dev" data-toggle="tab"><span class="glyphicon glyphicon-wrench"></span> Game Developer</a></li>
			<li class="dropdown pull-right" id="logoutDropdown">
				<a class="dropdown-toggle" data-toggle="dropdown" ><span class="glyphicon glyphicon-log-out"></span> Logout 
					<b class="caret"></b>
				</a>
				<ul class="dropdown-menu">
					<li><a href="#" id="logouturl">Logout</a></li>
				</ul>
			</li>
			<li class="dropdown pull-right" id="accountManageDropdown">
				<a class="dropdown-toggle" data-toggle="dropdown"><span class="glyphicon glyphicon-user"></span> Account Management
					<b class="caret"></b>
				</a>
				<div class="dropdown-menu" style="padding: 15px; padding-bottom: 15px; width: 300px; padding-left: 1cm; padding-right: 1cm">
					<div class="row" id="formId1">
					<div>

						<h4 class="page-header">You may update your information here</h4>
						<form role="form" id="post1">
							<div class="form-group float-label-control">
								<label for="">Email</label> <input type="email" name="email"
									class="form-control" placeholder="Email">
							</div>
							<div class="form-group float-label-control">
								<label for="">Password</label> <input type="password" name="password"
									class="form-control" placeholder="Password">
							</div>
							<div class="form-group float-label-control">
								<label for="">Confirm Password</label><input type="password" name="confirm"
									class="form-control" placeholder="Password">
							</div>
							<div class="form-group float-label-control label-bottom">
								<label for="">First Name</label><input type="text" name="firstName"
									class="form-control" placeholder="First Name">
							</div>
							<div class="form-group float-label-control label-bottom">
								<label for="">Last Name</label><input type="text" name="lastName"
									class="form-control" placeholder="Last Name">
							</div>
							<div class="form-group float-label-control label-bottom">
								<label for="">Nickname</label><input type="text" name="nickName"
									class="form-control" placeholder="Nickname">
							</div>
							<div class="panel-footer" style="margin-bottom: -14px;">
								<input type="submit" class="btn btn-success" value="Submit" />
								<input type="reset" class="btn btn-danger" value="Clear" /> 
								<label id="response"></label>
							</div>
						</form>
					</div>
				</div>
				<div class="row" id="formId2">
					<div>

						<h4 class="page-header">You are social authorized user, please provide following information</h4>
						<form role="form" id="post2">
							<div class="form-group float-label-control label-bottom">
								<label for="">First Name</label> <input type="text" name="fistName"
									class="form-control" placeholder="First Name">
							</div>
							<div class="form-group float-label-control label-bottom" name="lastName">
								<label for="">Last Name</label> <input type="text"
									class="form-control" placeholder="Last Name">
							</div>
							<div class="form-group float-label-control label-bottom" name="nickName">
								<label for="">Nickname</label> <input type="text"
									class="form-control" placeholder="Nickname">
							</div>
							<div class="panel-footer" style="margin-bottom: -14px;">
								<input type="submit" class="btn btn-success" value="Submit" />
								<input type="reset" class="btn btn-danger" value="Clear" />
								<label id="response"></label>
							</div>
						</form>
					</div>
				</div>
				</div>
			</li>
			<li class="pull-right"><a href="#play" data-toggle="tab" id="greeting"><span class="glyphicon glyphicon-cog"></span></a></li>
		</ul>
		<div id="my-tab-content" class="tab-content">
			<div class="tab-pane active" id="play">
				<div class="page-header">Enjoy your game</div>
				<div>
					<iframe width="100%" height="1000" id="playerpage">
					</iframe>
				</div>
			</div>
			
			<div class="tab-pane" id="dev">
				<div class="page-header">Deploy your game</div>
				<div>
					<iframe width="100%" height="1000" id="developerpage">
					</iframe>
				</div>
			</div>
		</div>

		<script type="text/javascript">
			jQuery(document).ready(function($) {
				$('#tabs').tab();
			});
		</script>
	</div>
</body>
</html>