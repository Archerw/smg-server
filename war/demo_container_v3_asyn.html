<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>dc_v3_asyn_local</title>
  <script type="text/javascript" src="../resources/jquery-1.11.0.min.js"></script>
  <script type="text/javascript" src="../resources/json2.js"></script>
</head>
<body>
<h3> Demo Page - Container V3</h3>

<style type="text/css">
        div.left, div.right {
        float: left;
        margin: 10px;    
    }
</style>

<div class="container">
    <div class="left" style="width:300px">
      <br><a href = "#" id = "NewPlayers">Insert Two Players</a>
      <br><a href = "#" id = "NewDevloper">Insert New Developer</a>
      <br><a href = "#" id = "NewGame">Insert New Game</a>
      <br>
      <br><a href = "#" id = "NewMatch">player1 Insert Match</a> 
      <br><a href = "#" id = "GetNewMatch">player2 Get Match</a>
      <br>
      <br><a href = "#" id = "MakeMove">player1 Make A Move</a> 
      <br><a href = "#" id = "GetState2">player2 Get State</a>
      <br>
      <br><a href = "#" id = "MakeMove2">Player2 Make A Move</a>
      <br><a href = "#" id = "GetState">Player1 Get State</a>
      <br>
      <br><a href = "#" id = "EndGame">player1 EndGame</a>
      <br>
     <!-- <br><a href = "#" id = "GetMatchInfo">Get Match Info</a> -->
      <br><a href = "#" id = "Clear">Delete Players/Game/Developer</a>
    </div>
    <div id="response" class="right" style="width:500px">Response</div>
</div>

<script type="text/javascript">

//var domainUrl = "http://4-dot-smg-server-rl.appspot.com";
var domainUrl = "http://4-dot-smg-server.appspot.com";
//var domainUrl = "http://localhost:8888";
var playerId = "";
var accessSignature ="";
var playerId2 = "";
var accessSignature2 = "";
var gameId = "";
var matchId = "";
var developerId = "";
var developerAS = "";

$(document).ready(function() {
  
  $("#NewPlayers").on("click", function(event) {
    ajaxCallNewPlayer( domainUrl+"/players");
    ajaxCallNewPlayer2( domainUrl+"/players");
  });

  $("#NewDevloper").on("click", function(event) {
    ajaxCallNewDeveloper( domainUrl+"/developers");
  });

  $("#NewGame").on("click", function(event) {
    ajaxCallNewGame( domainUrl+"/games");
  });

  $("#Clear").on("click", function(event) {
    ajaxCallDelPlayer( domainUrl+"/players/"+playerId+"?accessSignature="+accessSignature);
    ajaxCallDelPlayer2( domainUrl+"/players/"+playerId2+"?accessSignature="+accessSignature2);
    ajaxCallDelGame( domainUrl+"/games/"+gameId+"?developerId="+developerId+"&accessSignature="+developerAS);
    ajaxCallDelDeveloper( domainUrl+"/developers/"+developerId+"?accessSignature="+developerAS);
  });

  $("#NewMatch").on("click", function(event) {
    ajaxCallNewMatch( domainUrl+"/newMatch");
  });
  
  $("#GetNewMatch").on("click", function(event) {
    ajaxCallGetNewMatch( domainUrl+"/newMatch/"+playerId2+"?accessSignature="+accessSignature2);
  });

  $("#GetState").on("click", function(event) {
    ajaxCallGetState( domainUrl+"/state/"+matchId+"?playerId="+playerId+"&accessSignature="+accessSignature);
  });

  $("#GetState2").on("click", function(event) {
    ajaxCallGetState2( domainUrl+"/state/"+matchId+"?playerId="+playerId2+"&accessSignature="+accessSignature2);
  });

  $("#NewMatch_parse_error").on("click", function(event) {
    ajaxCallNewMatch_parse_error(domainUrl+"/newMatch");
  });
  
  $("#MakeMove").on("click", function(event) {
      var playerIds = [];
      playerIds.push(playerId);
      playerIds.push(playerId2);
      var jsonObj = {
          "accessSignature":accessSignature2, 
          "playerIds":playerIds, 
          "operations":[{"type":"SetTurn","playerId":playerId,"numberOfSecondsForTurn":0},{"type":"Set","key":"C1","value":"AA","visibleToPlayerIds":"ALL"},{"type":"Set","key":"C2","value":"BB","visibleToPlayerIds":"ALL"},{"type":"SetVisibility","key":"C1","visibleToPlayerIds":[playerId]},{"type":"SetVisibility","key":"C2","visibleToPlayerIds":[playerId]}]
      };
      var jsonString = "{\"accessSignature\":\""+accessSignature+"\",\"playerIds\":[\""+playerId+"\",\""+playerId2+"\"],\"operations\":[{\"type\":\"SetTurn\",\"playerId\":\""+playerId2+"\",\"numberOfSecondsForTurn\":0},{\"type\":\"Set\",\"key\":\"C1\",\"value\":\"AA\",\"visibleToPlayerIds\":\"ALL\"},{\"type\":\"Set\",\"key\":\"C2\",\"value\":\"BB\",\"visibleToPlayerIds\":\"ALL\"},{\"type\":\"SetVisibility\",\"key\":\"C1\",\"visibleToPlayerIds\":[\""+playerId+"\"]},{\"type\":\"SetVisibility\",\"key\":\"C2\",\"visibleToPlayerIds\":[\""+playerId+"\"]}]}";

      $.ajax({
        url: domainUrl+"/matches/"+matchId, 
        type: "POST",
        dataType: 'json',
        data: jsonString,
        success: function(data, textStatus, jqXHR) {
          $("#response").append("<br>" + JSON.stringify(data));
        },
        error: function(jqXHR, textStatus, errorThrown) {
          alert("ERROR: " + textStatus + " " + errorThrown);
        }});
  });

  $("#MakeMove2").on("click", function(event) {
      var playerIds = [];
      playerIds.push(playerId);
      playerIds.push(playerId2);
      var jsonObj = {
          "accessSignature":accessSignature, 
          "playerIds":playerIds, 
          "operations":[{"type":"SetTurn","playerId":playerId,"numberOfSecondsForTurn":0},{"type":"Set","key":"W","value":[1,2,3,4,5,6,7,8,9,10,11,13,14,16,17,18,19,20,21,23,24,25],"visibleToPlayerIds":"ALL"},{"type":"Set","key":"M","value":[12,22,0,15],"visibleToPlayerIds":"ALL"},{"type":"Set","key":"claim","value":["4cards","rank5"],"visibleToPlayerIds":"ALL"}]
      };

      var jsonString = "{\"accessSignature\":\""+accessSignature2+"\",\"playerIds\":[\""+playerId+"\",\""+playerId2+"\"],\"operations\":[{\"type\":\"SetTurn\",\"playerId\":\""+playerId+"\",\"numberOfSecondsForTurn\":0},{\"type\":\"Set\",\"key\":\"C3\",\"value\":\"CC\",\"visibleToPlayerIds\":[\""+playerId2+"\"]},{\"type\":\"Set\",\"key\":\"C4\",\"value\":\"DD\",\"visibleToPlayerIds\":[\""+playerId2+"\"]}]}";

      $.ajax({
        url: domainUrl+"/matches/"+matchId, 
        type: "POST",
        dataType: 'json',
        data: jsonString,
        success: function(data, textStatus, jqXHR) {
          $("#response").append("<br>" + JSON.stringify(data));
        },
        error: function(jqXHR, textStatus, errorThrown) {
          alert("ERROR: " + textStatus + " " + errorThrown);
        }});
  });

  $("#EndGame").on("click", function(event) {
      var playerIds = [];
      playerIds.push(playerId);
      playerIds.push(playerId2);
      var jsonString = "{\"accessSignature\":\""+accessSignature+"\",\"playerIds\":[\""+playerId+"\",\""+playerId2+"\"],\"operations\":[{\"type\":\"SetTurn\",\"playerId\":\""+playerId2+"\",\"numberOfSecondsForTurn\":0},{\"playerIdToScore\":{\""+playerId+"\":1},\"type\":\"EndGame\"}],\"gameOverReason\":\"Time Out\"}";
      console.log(jsonString);
      $.ajax({
        url: domainUrl+"/matches/"+matchId, 
        type: "POST",
        dataType: 'json',
        data: jsonString,
        success: function(data, textStatus, jqXHR) {
          $("#response").append("<br>" + JSON.stringify(data));
        },
        error: function(jqXHR, textStatus, errorThrown) {
          alert("ERROR: " + textStatus + " " + errorThrown);
        }});
  });

  $("#GetMatchInfo").on("click", function(event) {
      $.ajax({
        url: domainUrl+"/matches/"+matchId+"?accessSignature="+accessSignature+"&playerId="+playerId, 
        type: "GET",
        success: function(data, textStatus, jqXHR) {
          var jsonObj = $.parseJSON(data);
          $("#response").append("<br>" + JSON.stringify(jsonObj));
        },
        error: function(jqXHR, textStatus, errorThrown) {
          alert("ERROR: " + textStatus + " " + errorThrown);
        }});
  });
});

function ajaxCallNewPlayer(url) {
  var jsonObj = { 
      "email":"forcontainertestNEW@gmail.com",
      "password":"foobar",
      "firstName":"foo",
      "lastName":"bar",
      "nickName":"foobar" }
  $.ajax({
    url: url, 
    type: 'POST',
    dataType: 'json',
    data: JSON.stringify(jsonObj),
    success: function(data, textStatus, jqXHR) {           
      if (data['error'] == undefined) {
        playerId = data['playerId'];
        accessSignature = data["accessSignature"];
      } 
      $("#response").append("<br>" + JSON.stringify(data));
    },
    error: function(jqXHR, textStatus, errorThrown) {
      alert("ERROR: " + textStatus + " " + errorThrown);
    }
    });
}

function ajaxCallNewPlayer2(url) {
  var jsonObj = { 
      "email":"forcontainertestNEW2@gmail.com",
      "password":"foobar",
      "firstName":"foo",
      "lastName":"bar",
      "nickName":"foobar" }
  $.ajax({
    url: url, 
    type: 'POST',
    dataType: 'json',
    data: JSON.stringify(jsonObj),
    success: function(data, textStatus, jqXHR) { 
      if (data['error'] == undefined) {
        playerId2 = data['playerId'];
        accessSignature2 = data["accessSignature"];
      } 
      $("#response").append("<br>" + JSON.stringify(data));    
    },
    error: function(jqXHR, textStatus, errorThrown) {
      alert("ERROR: " + textStatus + " " + errorThrown);
    }
    });
}

function ajaxCallDelPlayer(url) {
  $.ajax({
    url: url, 
    type: "DELETE",
    crossDomain: true,
    async: false,
    success: function(data, textStatus, jqXHR) {
      $("#response").append("<br>" + JSON.stringify(data));
    },
    error: function(jqXHR, textStatus, errorThrown) {
      alert("ERROR: " + textStatus + " " + errorThrown);
    }});
}

function ajaxCallDelPlayer2(url) {
  $.ajax({
    url: url, 
    type: "DELETE",
    crossDomain: true,
    async: false,
    success: function(data, textStatus, jqXHR) {
      $("#response").append("<br>" + JSON.stringify(data));
    },
    error: function(jqXHR, textStatus, errorThrown) {
      alert("ERROR: " + textStatus + " " + errorThrown);
    }});
}

function ajaxCallNewDeveloper(url) {
  var jsonObj =  { "email": "forcontainertestNEW3@bladsfah.com", 
      "password": "soldkfjlaskdf",
      "nickName": "blahb lah blah",
      "whatever": "some thing should be deleted"
    }
  $.ajax({
    url: url, 
    type: 'POST',
    dataType: 'json',
    data: JSON.stringify(jsonObj),
    success: function(data, textStatus, jqXHR) { 
      if (data['error'] == undefined) {
        developerId = data['developerId'];
        developerAS = data["accessSignature"];
      } 
      $("#response").append("<br>" + JSON.stringify(data));   
    },
    error: function(jqXHR, textStatus, errorThrown) {
      alert("ERROR: " + textStatus + " " + errorThrown);
    }
    });
}

function ajaxCallDelDeveloper(url) {
  $.ajax({
    url: url, 
    type: "DELETE",
    crossDomain: true,
    async: false,
    success: function(data, textStatus, jqXHR) {
      $("#response").append("<br>" + JSON.stringify(data));
    },
    error: function(jqXHR, textStatus, errorThrown) {
      alert("ERROR: " + textStatus + " " + errorThrown);
    }});
}

function ajaxCallNewGame(url) {
  var jsonObj = {
        "gameName": "TEST GAME for container",
        "url" : "www.foo.com",
        "description": "This game is actually quite self-explanatory",
        "width" : 50,
        "height" : 100,
        "pic" : "{\"icon\" : \"www.google.com\" , \"screenshots\" : [\"www.test1.com\",\"www.test2.com\"]}",
        "developerId" : developerId,
        "accessSignature": developerAS
    };
  $.ajax({
    url: url, 
    type: 'POST',
    dataType: 'json',
    data: JSON.stringify(jsonObj),
    success: function(data, textStatus, jqXHR) {
      //var jsonObj = $.parseJSON(data);
      if (data['error'] == undefined) {
        var id = new Number(data['gameId']);
        gameId = id.toString();
      } 
      $("#response").append("<br>" + JSON.stringify(data));
    },
    error: function(jqXHR, textStatus, errorThrown) {
      alert("ERROR: " + textStatus + " " + errorThrown);
    }});
}

function ajaxCallDelGame(url) {
  $.ajax({
    url: url, 
    type: "DELETE",
    crossDomain: true,
    async: false,
    success: function(data, textStatus, jqXHR) {
      $("#response").append("<br>" + JSON.stringify(data));
    },
    error: function(jqXHR, textStatus, errorThrown) {
      alert("ERROR: " + textStatus + " " + errorThrown);
    }});
}

function ajaxCallNewMatch(url) {
  var playerIds = [];
      playerIds.push(playerId);
      playerIds.push(playerId2);
  var jsonObj = { 'accessSignature': accessSignature,
                  'playerIds': playerIds,
                  'gameId': gameId }
  $.ajax({
    url: url, 
    type: 'POST',
    dataType: 'json',
    data: JSON.stringify(jsonObj),
    success: function(data, textStatus, jqXHR) { 
      if (data['error'] == undefined) {
        matchId = data['matchId'];
      } 
      $("#response").append("<br>" + JSON.stringify(data));    
    },
    error: function(jqXHR, textStatus, errorThrown) {
      alert("ERROR: " + textStatus + " " + errorThrown);
    }
    });
}

function ajaxCallGetNewMatch(url) {
  $.ajax({
    url: url,
    type: 'GET',
    success: function(data, textStatus, jqXHR) {  
      var jsonObj = $.parseJSON(data);   
      $("#response").append("<br>" + JSON.stringify(jsonObj));
    },
    error: function(jqXHR, textStatus, errorThrown) {
      alert("ERROR: " + textStatus + " " + errorThrown);
    }
  });
}

function ajaxCallGetState(url) {
  $.ajax({
    url: url,
    type: 'GET',
    success: function(data, textStatus, jqXHR) {  
      var jsonObj = $.parseJSON(data);   
      $("#response").append("<br>" + JSON.stringify(jsonObj));
    },
    error: function(jqXHR, textStatus, errorThrown) {
      alert("ERROR: " + textStatus + " " + errorThrown);
    }
  });
}

function ajaxCallGetState2(url) {
  $.ajax({
    url: url,
    type: 'GET',
    success: function(data, textStatus, jqXHR) {  
      var jsonObj = $.parseJSON(data);   
      $("#response").append("<br>" + JSON.stringify(jsonObj));
    },
    error: function(jqXHR, textStatus, errorThrown) {
      alert("ERROR: " + textStatus + " " + errorThrown);
    }
  });
}

function ajaxCallNewMatch_parse_error(url) {
  $.ajax({
    url: url, 
    type: 'POST',
    dataType: 'json',
    data: 'dfdf=sdfsdf',
    success: function(data, textStatus, jqXHR) {     
      $("#response").append("<br>" + JSON.stringify(data));
    },
    error: function(jqXHR, textStatus, errorThrown) {
      alert("ERROR: " + textStatus + " " + errorThrown);
    }
    });
}
</script>
</body>
</html>
